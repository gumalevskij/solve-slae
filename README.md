# Решение плотной СЛАУ

Есть система линейных алгебраических уравнений 
**Ax = b**,
где **A** – это матрица системы, **x** – столбец неизвестных, а **b** – столбец свободных членов.

Матрица **A** и вектор **b** заданы в приложенных csv файлах.

Необходимо реализовать алгоритм решения данной СЛАУ – найти значения вектора **x**. Алгоритм решения может быть любым. Однако, эффективный алгоритм будет оценен дополнительным бонусом.

Разрешено использовать сторонние пакеты с открытым исходным кодом.

Также, необходимо будет пояснить реализацию алгоритма, шаги выполнения,  общий смысл и сложность.

---

## Решение

### 1. Использованные методы
Для решения системы было реализовано несколько подходов с целью анализа производительности и точности. В работе использованы следующие методы:
1. **LU-разложение с частичной выборкой главного элемента (partial pivoting)** –  реализация из библиотеки **Eigen**.
2. **LU-разложение с полной выборкой главного элемента (full pivoting)** – реализация из библиотеки **Eigen**.
3. **Сингулярное разложение (SVD)** – реализация из библиотеки **Eigen**.
4. **Алгоритм на основе OpenBLAS (dgesv)** – параллельная реализация из библиотеки **OpenBLAS**.
5. **Простая реализация LU-разложения**.

---

### 2. Шаги выполнения

1. **Чтение данных**  
   - Матрица **A** и вектор **b** считываются из CSV-файлов.

2. **Реализация алгоритмов**  
   - Используются описанные методы для вычисления решения вектора **x**.

3. **Сравнение результатов**  
   - Для каждого метода рассчитываются:
     - Время выполнения.
     - Невязка: **∥Ax − b∥**.

4. **Параллельные вычисления**  
   - Реализация на основе **OpenBLAS (dgesv)** использует параллельные вычисления, остальные методы работают в однопоточном режиме.

5. **Запись результатов**  
   - Решения и метрики сохраняются в файл **x_"solver".csv**.

---

### 3. Результаты

#### Производительность и точность на 6 потоках:
| Метод                          | Время выполнения (ms) | Невязка (**∥Ax − b∥**) |
|--------------------------------|------------------------|-------------------------|
| LU (partial pivoting, Eigen)   | 45.2213               | 4.51841e-09            |
| LU (full pivoting, Eigen)      | 295.655               | 3.97957e-09            |
| SVD (Eigen)                    | 17091.7               | 7.1178e-08             |
| OpenBLAS (dgesv)               | 11.795                | 6.11284e-09            |
| Simple LU (custom)             | 401.432               | 4.91662e-06            |

#### Производительность и точность на 1 потоке:
| Метод                          | Время выполнения (ms) | Невязка (**∥Ax − b∥**) |
|--------------------------------|------------------------|-------------------------|
| LU (partial pivoting, Eigen)   | 41.621                | 4.51841e-09            |
| LU (full pivoting, Eigen)      | 286.42                | 3.97957e-09            |
| SVD (Eigen)                    | 14400.3               | 7.1178e-08             |
| OpenBLAS (dgesv)               | 23.5979               | 4.84393e-09            |
| Simple LU (custom)             | 349.121               | 4.91662e-06            |



Приведённые значения времени являются приблизительными, так как замеры производились не на изолированной машине.

---

### 4. Анализ методов

- **LU-разложение с частичной выборкой главного элемента (partial pivoting)**  
  - Баланс между производительностью и точностью.

- **LU-разложение с полной выборкой главного элемента (full pivoting)**  
  - Более точный метод, но значительно медленнее. Время выполнения на порядок больше из-за дополнительных вычислений для выбора ведущих элементов.

- **SVD (сингулярное разложение)**  
  - Высокая устойчивость к численным ошибкам, но значительно проигрывает в производительности. Подходит для плохо обусловленных матриц.

- **OpenBLAS (dgesv)**  
  - Наиболее быстрый метод, также имеет дополнительное преимущество за счёт параллельных вычислений. Точность близка к LU с частичной выборкой.

- **Простая реализация LU**  
  - Наименее точный метод, высокая невязка. Время выполнения значительно хуже по сравнению с производительными подходами из Eigen и OpenBLAS.

---

### 5. Выводы

- Для задач, требующих максимальной производительности и приемлемой точности, рекомендуется использование **OpenBLAS (dgesv)**.
- Если требуется высокая устойчивость к численным ошибкам, предпочтителен LU-разложение с полным выбором ведущего элемента или **SVD**.
- Для данной матрицы все методы из сторонних пакетов показали сопоставимые результаты с невязкой порядка **$10^{-8}$** и реализованный метод с невязкой порядка **$10^{-6}$**, что показывает хорошую точность с учетом числа обусловленности равным **$10^5$**.

---

### 6. Сложность алгоритмов

| Метод                          | Сложность разложения   | Сложность решения (прямая и обратная подстановки)  | Итоговая сложность   |
|--------------------------------|------------------------|----------------------------------------------------|----------------------|
| **LU (partial pivoting)**      | **O($n^3$)**           | **O($n^2$)**                                       | **O($n^3$)**         |
| **LU (full pivoting)**         | **O($n^3$)**           | **O($n^2$)**                                       | **O($n^3$)**         |
| **SVD**                        | **O($n^3$)**           | **O($n^2$)**                                       | **O($n^3$)**         |
| **OpenBLAS (dgesv)**           | **O($n^3$)**           | **O($n^2$)**                                       | **O($n^3$)**         |
| **Simple LU**                  | **O($n^3$)**           | **O($n^2$)**                                       | **O($n^3$)**         |

#### Особенности
1. Все методы имеют сложность разложения **O($n^3$)**, поскольку базируются на операциях, зависящих от размера матрицы.
2. Сложность этапа решения системы после разложения, включающего прямую и обратную подстановки, составляет **O($n^2$)**.
3. Итоговая сложность всех методов равна **O($n^3$)**, но реальное время выполнения значительно различается из-за оптимизаций (например, использование многопоточности в OpenBLAS и использование блочных подходов, учитывающих иерархию памяти).

### 7. Подготовка и запуск программы

Для успешного запуска программы выполните следующие шаги:

1. Клонируйте репозиторий **Eigen**:
   ```bash
   git clone https://gitlab.com/libeigen/eigen.git
   ```
2. Установите библиотеку **OpenBLAS**:
   ```bash
   sudo apt install libopenblas-dev
   ```
3. Установите переменную окружения **EIGENDIR** и соберите проект:
   ```bash
   export EIGENDIR=/home/gumalevskii/Interviews/Arhitex/eigen

   make
   ```
4. Запустите программу, указав количество потоков:

- Для однопоточного выполнения:                               
   ```bash                          
   OMP_NUM_THREADS=1 ./SolveMatrix
   ```
- Для многопоточного выполнения:                               
   ```bash                          
   OMP_NUM_THREADS=6 ./SolveMatrix
   ```
